{"version":3,"sources":["ScrollPager.tsx"],"names":["React","StyleSheet","Keyboard","Animated","event","divide","Value","ScrollPager","initialOffset","x","props","navigationState","index","layout","width","y","scrollViewRef","createRef","jumpTo","key","keyboardDismissMode","onIndexChange","routes","findIndex","route","scrollTo","dismiss","animated","current","getNode","enterListeners","addListener","type","listener","push","removeListener","indexOf","splice","position","onScroll","nativeEvent","contentOffset","layoutWidthNode","relativePosition","prevProps","offset","length","setValue","children","onSwipeStart","onSwipeEnd","overscroll","render","swipeEnabled","styles","container","flexDirection","flex","Component","defaultProps","bounces","create"],"mappings":"kaAAA,MAAO,GAAKA,CAAAA,KAAZ,KAAuB,OAAvB,CACA,OAASC,UAAT,CAAqBC,QAArB,KAAqC,cAArC,CACA,MAAOC,CAAAA,QAAP,KAAqB,yBAArB,C,GAIQC,CAAAA,K,CAAyBD,Q,CAAzBC,K,CAAOC,M,CAAkBF,Q,CAAlBE,M,CAAQC,K,CAAUH,Q,CAAVG,K,IAaFC,CAAAA,W,kZAqCXC,a,CAAgB,CACtBC,CAAC,CAAE,MAAKC,KAAL,CAAWC,eAAX,CAA2BC,KAA3B,CAAmC,MAAKF,KAAL,CAAWG,MAAX,CAAkBC,KADlC,CAEtBC,CAAC,CAAE,CAFmB,C,OAKhBC,a,CAAgBhB,KAAK,CAACiB,SAAN,E,OAEhBC,M,CAAS,SAACC,GAAD,CAAiB,iBACgC,MAAKT,KADrC,CACxBC,eADwB,aACxBA,eADwB,CACPS,mBADO,aACPA,mBADO,CACcC,aADd,aACcA,aADd,CAGhC,GAAMT,CAAAA,KAAK,CAAGD,eAAe,CAACW,MAAhB,CAAuBC,SAAvB,CAAiC,SAAAC,KAAK,QAAIA,CAAAA,KAAK,CAACL,GAAN,GAAcA,GAAlB,EAAtC,CAAd,CAEA,GAAIR,eAAe,CAACC,KAAhB,GAA0BA,KAA9B,CAAqC,CACnC,MAAKa,QAAL,CAAcb,KAAK,CAAG,MAAKF,KAAL,CAAWG,MAAX,CAAkBC,KAAxC,EACD,CAFD,IAEO,CACLO,aAAa,CAACT,KAAD,CAAb,CACA,GAAIQ,mBAAmB,GAAK,MAA5B,CAAoC,CAClClB,QAAQ,CAACwB,OAAT,GACD,CACF,CACF,C,OAEOD,Q,CAAW,SAAChB,CAAD,CAAgC,IAApBkB,CAAAA,QAAoB,2DAAT,IAAS,CACjD,GAAI,MAAKX,aAAL,CAAmBY,OAAvB,CAAgC,CAC9B,MAAKZ,aAAL,CAAmBY,OAAnB,CAA2BC,OAA3B,GAAqCJ,QAArC,CAA8C,CAC5ChB,CAAC,CAADA,CAD4C,CAE5CkB,QAAQ,CAAEA,QAFkC,CAA9C,EAID,CACF,C,OAEOG,c,CAA6B,E,OAE7BC,W,CAAc,SAACC,IAAD,CAAgBC,QAAhB,CAAuC,CAC3D,OAAQD,IAAR,EACE,IAAK,OAAL,CACE,MAAKF,cAAL,CAAoBI,IAApB,CAAyBD,QAAzB,EACA,MAHJ,CAKD,C,OAEOE,c,CAAiB,SAACH,IAAD,CAAgBC,QAAhB,CAAuC,CAC9D,OAAQD,IAAR,EACE,IAAK,OAAL,CAAc,CACZ,GAAMpB,CAAAA,KAAK,CAAG,MAAKkB,cAAL,CAAoBM,OAApB,CAA4BH,QAA5B,CAAd,CAEA,GAAIrB,KAAK,CAAG,CAAC,CAAb,CAAgB,CACd,MAAKkB,cAAL,CAAoBO,MAApB,CAA2BzB,KAA3B,CAAkC,CAAlC,EACD,CAED,MACD,CATH,CAWD,C,OAEO0B,Q,CAAW,GAAInC,CAAAA,QAAQ,CAACG,KAAb,CACjB,MAAKI,KAAL,CAAWC,eAAX,CAA2BC,KAA3B,CAAmC,MAAKF,KAAL,CAAWG,MAAX,CAAkBC,KADpC,C,OAIXyB,Q,CAAWnC,KAAK,CAAC,CACvB,CACEoC,WAAW,CAAE,CACXC,aAAa,CAAE,CACbhC,CAAC,CAAE,MAAK6B,QADK,CADJ,CADf,CADuB,CAAD,C,OAUhBI,e,CAAkB,GAAIpC,CAAAA,KAAJ,CAAU,MAAKI,KAAL,CAAWG,MAAX,CAAkBC,KAA5B,C,OAElB6B,gB,CAAmBtC,MAAM,CAAC,MAAKiC,QAAN,CAAgB,MAAKI,eAArB,C,oGApGb,CAClB,GAAI,KAAKhC,KAAL,CAAWG,MAAX,CAAkBC,KAAtB,CAA6B,CAC3B,KAAKW,QAAL,CACE,KAAKf,KAAL,CAAWC,eAAX,CAA2BC,KAA3B,CAAmC,KAAKF,KAAL,CAAWG,MAAX,CAAkBC,KADvD,CAEE,KAFF,EAID,CACF,C,8DAEkB8B,S,CAAqB,CACtC,GAAMC,CAAAA,MAAM,CAAG,KAAKnC,KAAL,CAAWC,eAAX,CAA2BC,KAA3B,CAAmC,KAAKF,KAAL,CAAWG,MAAX,CAAkBC,KAApE,CAEA,GACE8B,SAAS,CAACjC,eAAV,CAA0BW,MAA1B,CAAiCwB,MAAjC,GACE,KAAKpC,KAAL,CAAWC,eAAX,CAA2BW,MAA3B,CAAkCwB,MADpC,EAEAF,SAAS,CAAC/B,MAAV,CAAiBC,KAAjB,GAA2B,KAAKJ,KAAL,CAAWG,MAAX,CAAkBC,KAH/C,CAIE,CACA,KAAKW,QAAL,CAAcoB,MAAd,CAAsB,KAAtB,EACD,CAND,IAMO,IACLD,SAAS,CAACjC,eAAV,CAA0BC,KAA1B,GAAoC,KAAKF,KAAL,CAAWC,eAAX,CAA2BC,KAD1D,CAEL,CACA,KAAKa,QAAL,CAAcoB,MAAd,EACD,CAED,GAAID,SAAS,CAAC/B,MAAV,CAAiBC,KAAjB,GAA2B,KAAKJ,KAAL,CAAWG,MAAX,CAAkBC,KAAjD,CAAwD,CACtD,KAAK4B,eAAL,CAAqBK,QAArB,CAA8B,KAAKrC,KAAL,CAAWG,MAAX,CAAkBC,KAAhD,EACD,CACF,C,uCA2EQ,kCAQH,KAAKJ,KARF,CAELsC,QAFK,cAELA,QAFK,CAGLnC,MAHK,cAGLA,MAHK,CAILoC,YAJK,cAILA,YAJK,CAKLC,UALK,cAKLA,UALK,CAMLC,UANK,cAMLA,UANK,CAOLxC,eAPK,cAOLA,eAPK,CAUP,MAAOqC,CAAAA,QAAQ,CAAC,CACdV,QAAQ,CAAE,KAAKK,gBADD,CAEdZ,WAAW,CAAE,KAAKA,WAFJ,CAGdI,cAAc,CAAE,KAAKA,cAHP,CAIdjB,MAAM,CAAE,KAAKA,MAJC,CAKdkC,MAAM,CAAE,gBAAAJ,QAAQ,QACd,qBAAC,QAAD,CAAU,UAAV,EACE,aAAa,KADf,CAEE,sBAAsB,KAFxB,CAGE,mBAAmB,CAAC,SAHtB,CAIE,yBAAyB,CAAC,QAJ5B,CAKE,cAAc,CAAC,OALjB,CAME,uBAAuB,KANzB,CAOE,aAAa,CAAE,MAAI,CAACtC,KAAL,CAAW2C,YAP5B,CAQE,gCAAgC,CAAE,KARpC,CASE,OAAO,CAAEF,UATX,CAUE,YAAY,CAAE,KAVhB,CAWE,8BAA8B,CAAE,KAXlC,CAYE,mBAAmB,CAAE,CAZvB,CAaE,QAAQ,CAAE,MAAI,CAACZ,QAbjB,CAcE,iBAAiB,CAAEU,YAdrB,CAeE,eAAe,CAAEC,UAfnB,CAgBE,mBAAmB,CAAE,MAAI,CAACX,QAhB5B,CAiBE,aAAa,CAAE,MAAI,CAAC/B,aAjBtB,CAkBE,KAAK,CAAE8C,MAAM,CAACC,SAlBhB,CAmBE,qBAAqB,CACnB1C,MAAM,CAACC,KAAP,CACI,CACE0C,aAAa,CAAE,KADjB,CAEE1C,KAAK,CAAED,MAAM,CAACC,KAAP,CAAeH,eAAe,CAACW,MAAhB,CAAuBwB,MAF/C,CAGEW,IAAI,CAAE,CAHR,CADJ,CAMI,IA1BR,CA4BE,GAAG,CAAE,MAAI,CAACzC,aA5BZ,kDA8BGgC,QA9BH,CADc,EALF,CAAD,CAAf,CAwCD,C,yBAhKuDhD,KAAK,CAAC0D,S,EAA3CnD,W,CAIZoD,Y,CAAe,CACpBC,OAAO,CAAE,IADW,C,QAJHrD,W,aAmKrB,GAAM+C,CAAAA,MAAM,CAAGrD,UAAU,CAAC4D,MAAX,CAAkB,CAC/BN,SAAS,CAAE,CACTE,IAAI,CAAE,CADG,CADoB,CAAlB,CAAf","sourcesContent":["import * as React from 'react';\nimport { StyleSheet, Keyboard } from 'react-native';\nimport Animated from 'react-native-reanimated';\nimport { Props } from './Pager';\nimport { Route, Listener } from './types';\n\nconst { event, divide, Value } = Animated;\n\ntype State = {\n  initialOffset: { x: number; y: number };\n};\n\n// @TODO osdnk: Remove it after fixing in DefinitelyTyped\ndeclare module 'react-native' {\n  export interface ScrollViewProps {\n    scrollToOverflowEnabled?: boolean;\n  }\n}\n\nexport default class ScrollPager<T extends Route> extends React.Component<\n  Props<T> & { overscroll?: boolean },\n  State\n> {\n  static defaultProps = {\n    bounces: true,\n  };\n\n  componentDidMount() {\n    if (this.props.layout.width) {\n      this.scrollTo(\n        this.props.navigationState.index * this.props.layout.width,\n        false\n      );\n    }\n  }\n\n  componentDidUpdate(prevProps: Props<T>) {\n    const offset = this.props.navigationState.index * this.props.layout.width;\n\n    if (\n      prevProps.navigationState.routes.length !==\n        this.props.navigationState.routes.length ||\n      prevProps.layout.width !== this.props.layout.width\n    ) {\n      this.scrollTo(offset, false);\n    } else if (\n      prevProps.navigationState.index !== this.props.navigationState.index\n    ) {\n      this.scrollTo(offset);\n    }\n\n    if (prevProps.layout.width !== this.props.layout.width) {\n      this.layoutWidthNode.setValue(this.props.layout.width);\n    }\n  }\n\n  private initialOffset = {\n    x: this.props.navigationState.index * this.props.layout.width,\n    y: 0,\n  };\n\n  private scrollViewRef = React.createRef<Animated.ScrollView>();\n\n  private jumpTo = (key: string) => {\n    const { navigationState, keyboardDismissMode, onIndexChange } = this.props;\n\n    const index = navigationState.routes.findIndex(route => route.key === key);\n\n    if (navigationState.index === index) {\n      this.scrollTo(index * this.props.layout.width);\n    } else {\n      onIndexChange(index);\n      if (keyboardDismissMode === 'auto') {\n        Keyboard.dismiss();\n      }\n    }\n  };\n\n  private scrollTo = (x: number, animated = true) => {\n    if (this.scrollViewRef.current) {\n      this.scrollViewRef.current.getNode().scrollTo({\n        x,\n        animated: animated,\n      });\n    }\n  };\n\n  private enterListeners: Listener[] = [];\n\n  private addListener = (type: 'enter', listener: Listener) => {\n    switch (type) {\n      case 'enter':\n        this.enterListeners.push(listener);\n        break;\n    }\n  };\n\n  private removeListener = (type: 'enter', listener: Listener) => {\n    switch (type) {\n      case 'enter': {\n        const index = this.enterListeners.indexOf(listener);\n\n        if (index > -1) {\n          this.enterListeners.splice(index, 1);\n        }\n\n        break;\n      }\n    }\n  };\n\n  private position = new Animated.Value(\n    this.props.navigationState.index * this.props.layout.width\n  );\n\n  private onScroll = event([\n    {\n      nativeEvent: {\n        contentOffset: {\n          x: this.position,\n        },\n      },\n    },\n  ]);\n\n  private layoutWidthNode = new Value(this.props.layout.width);\n\n  private relativePosition = divide(this.position, this.layoutWidthNode);\n\n  render() {\n    const {\n      children,\n      layout,\n      onSwipeStart,\n      onSwipeEnd,\n      overscroll,\n      navigationState,\n    } = this.props;\n\n    return children({\n      position: this.relativePosition,\n      addListener: this.addListener,\n      removeListener: this.removeListener,\n      jumpTo: this.jumpTo,\n      render: children => (\n        <Animated.ScrollView\n          pagingEnabled\n          directionalLockEnabled\n          keyboardDismissMode=\"on-drag\"\n          keyboardShouldPersistTaps=\"always\"\n          overScrollMode=\"never\"\n          scrollToOverflowEnabled\n          scrollEnabled={this.props.swipeEnabled}\n          automaticallyAdjustContentInsets={false}\n          bounces={overscroll}\n          scrollsToTop={false}\n          showsHorizontalScrollIndicator={false}\n          scrollEventThrottle={1}\n          onScroll={this.onScroll}\n          onScrollBeginDrag={onSwipeStart}\n          onScrollEndDrag={onSwipeEnd}\n          onMomentumScrollEnd={this.onScroll}\n          contentOffset={this.initialOffset}\n          style={styles.container}\n          contentContainerStyle={\n            layout.width\n              ? {\n                  flexDirection: 'row',\n                  width: layout.width * navigationState.routes.length,\n                  flex: 1,\n                }\n              : null\n          }\n          ref={this.scrollViewRef}\n        >\n          {children}\n        </Animated.ScrollView>\n      ),\n    });\n  }\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n});\n"]}